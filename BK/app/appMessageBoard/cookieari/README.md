# appMessageBoard の `app.js` 解説

## 概要
`app/appMessageBoard/app.js` は、Node.js の組み込み `http` モジュールでシンプルな伝言板サーバーを立ち上げ、EJS テンプレートを使ってブラウザにページを返すサンプルです。フォームから送信されたメッセージをメモリ上に保持し、トップページで表示することができます。

## 実行に必要なもの
- Node.js v18 以降を推奨（標準モジュール `http`、`fs`、`url`、`querystring` を使用）
- テンプレートエンジンとして `ejs` を利用します。まだインストールされていない場合はプロジェクトルートで以下を実行してください。

```bash
npm install ejs
```

## ファイル構成
- `app.js` : HTTP サーバー本体。ルーティングとリクエスト処理を担当します。
- `index.ejs` : トップページ用の EJS テンプレート。送信されたメッセージを表示します。
- `style.css` : トップページのスタイルシート。
- （任意）`other.ejs` : `/other` ルートで利用する EJS テンプレート想定。コード内では `other_page` という変数で参照しているため、必要に応じて `const other_page = fs.readFileSync('./other.ejs', 'utf8');` のように読み込んでください。

## 起動方法
プロジェクトルート、もしくは `app/appMessageBoard` ディレクトリに移動して次のコマンドを実行します。

```bash
node app.js
```

サーバーが起動するとポート `3000` で待ち受けるので、ブラウザで `http://localhost:3000/` を開きます。

## 主要モジュールと役割
- `http` : HTTP サーバーの生成とリクエストの受け取り。
- `fs` : EJS テンプレートとスタイルシートを同期的に読み込みます。
- `ejs` : テンプレートにデータをはめ込み、HTML を生成します。
- `url` : パス名などリクエスト URL の解析に使用します。
- `querystring` : POST されたフォームデータをオブジェクトに変換します。

## 処理の流れ
1. サーバー起動時に `index.ejs` と `style.css` を読み込み、`http.createServer` でリクエストを `getFromClient` 関数に渡します。
2. `getFromClient` ではパス名に応じて処理を振り分けます。
3. `/` ルートでは `response_index` が呼ばれ、GET 時はページを表示、POST 時は受信データをパースして保持したのちに再度ページを表示します。
4. `/style.css` ルートでは CSS をそのまま返却します。
5. `/other` ルートでは `response_other` が呼ばれ、POST されたメッセージをテンプレートに埋め込んで表示します（GET の場合はエラーメッセージを返却）。
6. 上記以外のパスにアクセスされた場合はプレーンテキストで `no page...` を返します。

## ルーティング詳細
| パス | メソッド | 処理概要 |
| ---- | -------- | -------- |
| `/` | GET | 伝言フォームと最新メッセージを表示。 |
| `/` | POST | フォーム内容をパースして `data` に保存し、トップページに再表示。 |
| `/other` | GET | 代替ページが無い旨のメッセージを表示。 |
| `/other` | POST | 送信メッセージをテンプレートに埋め込んで表示。 |
| `/style.css` | GET | スタイルシートを返却。 |
| その他 | GET | `no page...` というテキストを返却。 |

## 主要関数
- `getFromClient(request, response)`
  - URL を解析してルーティングするエントリポイント関数。
- `response_index(request, response)`
  - `/` ルートの処理を担当。POST の場合はボディを受信し終えた後に `write_index` を呼びます。
- `write_index(request, response)`
  - `index.ejs` を描画し、最新のメッセージを埋め込んで返却します。
- `response_other(request, response)`
  - `/other` ルートの処理。POST データがある場合はメッセージを作り替えてテンプレートにレンダリングします。

## データの保持について
`data` という変数で直近のメッセージをメモリ上に保持しています。ページをリロードするとフォームで送信した内容が表示されますが、サーバーを再起動するとリセットされます。永続化したい場合はファイルやデータベースへの保存処理を追加してください。

## カスタマイズのヒント
- ルーティングを追加したい場合は `switch` 文にケースを足し、対応するレスポンス関数を定義してください。
- 複数投稿を扱いたい場合は `data` を配列に置き換え、EJS 内で `forEach` して表示する実装が考えられます。
- `style.css` を拡張すれば簡単なデザイン変更も可能です。静的ファイルを増やす場合は同様に `case` を追加する、もしくは `fs.readFile` と `Content-Type` を使って返してください。

